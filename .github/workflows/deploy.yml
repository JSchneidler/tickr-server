name: ECS Deploy

on:
  workflow_run:
    workflows: ["Test"]
    branches: main
    types:
      - completed

env:
  ECR_REPOSITORY: tickr
  ECS_SERVICE: tickr-api
  ECS_CLUSTER: tickr-api
  ECS_TASK_DEFINITION: arn:aws:ecs:us-east-1:584676595568:task-definition/tickr-api:1
  CONTAINER_NAME: app

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success'}}
    runs-on: ubuntu-latest

    steps:
      - name: SSH
        uses: appleboy/ssh-action@master
        with:
          host: 2a01:4ff:1f0:8a4a::1
          username: root
          key: ${{ secrets.PRIVATE_KEY }}
          protocol: tcp6
          port: 22
          script: |
            touch here.md
